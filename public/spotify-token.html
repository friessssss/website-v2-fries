<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Refresh Token Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin-bottom: 30px;
            padding: 20px;
            border-left: 4px solid #1DB954;
            background-color: #f8f9fa;
        }
        .step h3 {
            color: #1DB954;
            margin-top: 0;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }
        button {
            background-color: #1DB954;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #1ed760;
        }
        .code-block {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Spotify Refresh Token Generator</h1>
        <p>Use this tool to generate a new Spotify refresh token for your RL Tracker.</p>
        
        <div class="step">
            <h3>üöÄ Quick Method (Recommended)</h3>
            <div class="success">
                <p><strong>üéâ Easy Solution:</strong> Use this online tool that handles everything automatically:</p>
                <a href="https://alecchen.dev/spotify-refresh-token/?scope=all" target="_blank" class="button" style="display: inline-block; margin: 10px 0; background-color: #1DB954; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none;">
                    üöÄ Use Easy Token Generator
                </a>
                <p><em>This tool will guide you through the entire process and generate your refresh token automatically!</em></p>
            </div>
        </div>

        <div class="step">
            <h3>Manual Method (Alternative)</h3>
            <p><em>Only use this if you prefer to do it manually:</em></p>

        <div class="step">
            <h3>Step 1: Enter Your Spotify App Credentials</h3>
            <label for="clientId">Client ID:</label>
            <input type="text" id="clientId" placeholder="Enter your Spotify Client ID">
            
            <label for="clientSecret">Client Secret:</label>
            <input type="text" id="clientSecret" placeholder="Enter your Spotify Client Secret">
        </div>

        <div class="step">
            <h3>Step 2: Generate Authorization URL</h3>
            <button onclick="generateAuthUrl()">Generate Authorization URL</button>
            <div id="authUrlOutput" class="code-block" style="display: none;"></div>
        </div>

        <div class="step">
            <h3>Step 3: Get Authorization Code</h3>
            <p>1. Click the authorization URL above</p>
            <p>2. Log in to Spotify and authorize the app</p>
            <p>3. Copy the code from the redirect URL</p>
            <label for="authCode">Authorization Code:</label>
            <input type="text" id="authCode" placeholder="Paste the authorization code here">
        </div>

        <div class="step">
            <h3>Step 4: Generate Refresh Token</h3>
            <button onclick="generateRefreshToken()">Generate Refresh Token</button>
            <div id="tokenOutput" class="code-block" style="display: none;"></div>
        </div>

        <div class="step">
            <h3>Step 5: Update Your Environment Variables</h3>
            <p>1. Go to your Vercel dashboard</p>
            <p>2. Find your project settings</p>
            <p>3. Go to Environment Variables</p>
            <p>4. Update <code>SPOTIFY_REFRESH_TOKEN</code> with the new token</p>
            <p>5. Redeploy your application</p>
        </div>
    </div>

    <script>
        function generateAuthUrl() {
            const clientId = document.getElementById('clientId').value;
            if (!clientId) {
                alert('Please enter your Client ID first');
                return;
            }

            const scopes = [
                'user-read-currently-playing',
                'user-read-playback-state',
                'playlist-read-private',
                'user-read-private'
            ];

            const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=code&redirect_uri=http://localhost:3000/callback&scope=${scopes.join('%20')}`;
            
            const output = document.getElementById('authUrlOutput');
            output.textContent = authUrl;
            output.style.display = 'block';
            
            // Create a clickable link
            const link = document.createElement('a');
            link.href = authUrl;
            link.target = '_blank';
            link.textContent = 'Click here to authorize';
            link.style.display = 'block';
            link.style.marginTop = '10px';
            link.style.color = '#1DB954';
            link.style.textDecoration = 'none';
            
            output.appendChild(link);
        }

        async function generateRefreshToken() {
            const clientId = document.getElementById('clientId').value;
            const clientSecret = document.getElementById('clientSecret').value;
            const authCode = document.getElementById('authCode').value;

            if (!clientId || !clientSecret || !authCode) {
                alert('Please fill in all fields');
                return;
            }

            const output = document.getElementById('tokenOutput');
            output.style.display = 'block';
            output.textContent = 'Generating refresh token...';

            try {
                // Create base64 encoded credentials
                const credentials = btoa(`${clientId}:${clientSecret}`);
                
                const response = await fetch('https://accounts.spotify.com/api/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': `Basic ${credentials}`
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: authCode,
                        redirect_uri: 'http://localhost:3000/callback'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    output.innerHTML = `
‚úÖ Refresh Token Generated Successfully!

Refresh Token: ${data.refresh_token}

Access Token: ${data.access_token}
Expires In: ${data.expires_in} seconds
Token Type: ${data.token_type}

‚ö†Ô∏è  Copy the refresh token above and update your Vercel environment variables!
                    `;
                    output.className = 'code-block success';
                } else {
                    output.innerHTML = `
‚ùå Error: ${data.error}

Error Description: ${data.error_description || 'Unknown error'}

Please check your credentials and try again.
                    `;
                    output.className = 'code-block error';
                }
            } catch (error) {
                output.innerHTML = `
‚ùå Network Error: ${error.message}

Please check your internet connection and try again.
                `;
                output.className = 'code-block error';
            }
        }
    </script>
</body>
</html> 